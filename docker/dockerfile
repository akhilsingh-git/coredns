# Dockerfile
FROM alpine:3.18

# Install tools you need, e.g. bind-tools for dig, curl for downloading
RUN apk add --no-cache bind-tools curl

# Set the CoreDNS version you want
ENV COREDNS_VERSION=1.11.3
WORKDIR /usr/bin

# Download and extract the official coredns binary
RUN curl -sSL \
      "https://github.com/coredns/coredns/releases/download/v${COREDNS_VERSION}/coredns_${COREDNS_VERSION}_linux_amd64.tgz" \
      -o /tmp/coredns.tgz \
 && tar -xzf /tmp/coredns.tgz \
 && chmod +x coredns \
 && rm /tmp/coredns.tgz

# Expose DNS port
EXPOSE 53/udp

# Default entrypoint runs the coredns binary
ENTRYPOINT ["/usr/bin/coredns"]
# Tells coredns to read /Corefile by default
CMD ["-conf", "/Corefile"]
